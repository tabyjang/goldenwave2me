# Phase 3.1: Premium Micro-Interaction - Hover Effects

## Objective

프리미엄 급 호버 인터랙션 컴포넌트 라이브러리를 구축하여 사용자 경험을 향상시킵니다. 4가지 호버 효과를 구현하고 재사용 가능한 컴포넌트로 제공합니다.

## Execution Context

**Current State:**
- 기존 애니메이션: 단순 scale만 (animated-button.tsx)
- motion (Framer Motion) 라이브러리 이미 설치됨
- 토큰 시스템 완료 (Phase 1)

**Target State:**
- `/components/animation-v2/hover/` 폴더에 4개 프리미엄 호버 컴포넌트
- MagneticButton, GlowCard, ParallaxCard, RippleButton
- 토큰 색상 시스템 활용
- TypeScript + 타입 안전성

**Files:**
- 기존: `src/components/animation/animated-button.tsx` (참고)
- 신규: `src/components/animation-v2/hover/` (4개 파일)

## Context

### 구현할 Hover Effects:

**1. MagneticButton** - 자석 효과 버튼
- 마우스 위치에 따라 버튼이 끌려가는 효과
- 부드러운 spring 애니메이션
- 마우스 벗어나면 원위치 복귀

**2. GlowCard** - 빛나는 카드
- 마우스 위치 따라 그라데이션 빛
- 토큰 primary 색상 사용
- 카드 테두리/배경에 glow 효과

**3. ParallaxCard** - 3D 틸트 카드
- 마우스 위치에 따라 3D 회전
- perspective 효과
- 내부 요소 레이어 분리 (parallax)

**4. RippleButton** - 물결 효과 버튼
- 클릭 시 원형 물결 애니메이션
- 토큰 primary 색상 사용
- 여러 번 클릭 시 중첩 효과

### Design Principles:
- 60fps 유지 (성능 최적화)
- 토큰 시스템 색상 사용
- 접근성 고려 (reduced motion 지원)
- TypeScript 타입 안전성
- 재사용성 극대화

## Tasks

<task id="1" name="animation-v2 폴더 구조 생성">
**What:** 새로운 애니메이션 컴포넌트를 위한 폴더 구조 설정

**How:**
1. `src/components/animation-v2/` 디렉토리 생성
2. 하위 폴더 생성:
   - `hover/` - 호버 효과 컴포넌트
   - `scroll/` - 스크롤 효과 (Phase 3.2에서 사용)
   - `transitions/` - 페이지 전환 (Phase 3.2에서 사용)
   - `utils/` - 공통 유틸리티
3. `index.ts` 파일 생성 (통합 export)

**폴더 구조:**
```
src/components/animation-v2/
├── hover/
│   └── index.ts (placeholder)
├── scroll/
│   └── index.ts (placeholder)
├── transitions/
│   └── index.ts (placeholder)
├── utils/
│   └── motion.ts (공통 유틸리티)
└── index.ts (메인 export)
```

**Success check:**
- 모든 폴더 생성 완료
- index.ts 파일들 생성됨
- TypeScript 컴파일 에러 없음
</task>

<task id="2" name="공통 유틸리티 함수 구현">
**What:** 애니메이션에서 공통으로 사용할 유틸리티 함수 작성

**How:**
1. `utils/motion.ts` 파일 생성
2. 구현할 함수들:
   - `useReducedMotion()` - prefers-reduced-motion 감지
   - `spring` - 공통 spring 설정 상수
   - `getTokenColor()` - 토큰 색상 가져오기
   - `calculateDistance()` - 거리 계산
   - `mapRange()` - 값 범위 매핑

**Example:**
```typescript
// utils/motion.ts
import { useEffect, useState } from 'react'
import { warmElegance } from '@/tokens'

export const spring = {
  type: 'spring',
  stiffness: 300,
  damping: 20,
} as const

export function useReducedMotion() {
  const [prefersReducedMotion, setPrefersReducedMotion] = useState(false)

  useEffect(() => {
    const mediaQuery = window.matchMedia('(prefers-reduced-motion: reduce)')
    setPrefersReducedMotion(mediaQuery.matches)

    const handler = () => setPrefersReducedMotion(mediaQuery.matches)
    mediaQuery.addEventListener('change', handler)
    return () => mediaQuery.removeEventListener('change', handler)
  }, [])

  return prefersReducedMotion
}

export const tokenColors = {
  primary: warmElegance.colors.primary[500],
  accent: warmElegance.colors.accent[500],
}
```

**Success check:**
- 모든 유틸리티 함수 구현됨
- useReducedMotion 작동 테스트
- TypeScript 타입 정의 완료
</task>

<task id="3" name="MagneticButton 구현">
**What:** 마우스 따라 끌려가는 자석 효과 버튼 컴포넌트

**How:**
1. `hover/MagneticButton.tsx` 파일 생성
2. 마우스 이벤트 핸들러:
   - onMouseMove: 마우스 위치 추적
   - onMouseLeave: 원위치 복귀
3. motion.div로 버튼 래핑
4. spring 애니메이션으로 부드러운 이동

**구현 로직:**
```typescript
'use client'

import { useRef, useState } from 'react'
import { motion } from 'motion/react'
import { spring } from '../utils/motion'

interface MagneticButtonProps {
  children: React.ReactNode
  strength?: number  // 자석 강도 (default: 0.5)
  className?: string
}

export function MagneticButton({
  children,
  strength = 0.5,
  className
}: MagneticButtonProps) {
  const ref = useRef<HTMLDivElement>(null)
  const [position, setPosition] = useState({ x: 0, y: 0 })

  const handleMouseMove = (e: React.MouseEvent) => {
    if (!ref.current) return

    const rect = ref.current.getBoundingClientRect()
    const centerX = rect.left + rect.width / 2
    const centerY = rect.top + rect.height / 2

    const deltaX = (e.clientX - centerX) * strength
    const deltaY = (e.clientY - centerY) * strength

    setPosition({ x: deltaX, y: deltaY })
  }

  const handleMouseLeave = () => {
    setPosition({ x: 0, y: 0 })
  }

  return (
    <motion.div
      ref={ref}
      onMouseMove={handleMouseMove}
      onMouseLeave={handleMouseLeave}
      animate={{ x: position.x, y: position.y }}
      transition={spring}
      className={className}
    >
      {children}
    </motion.div>
  )
}
```

**Success check:**
- 마우스 이동 시 버튼이 끌려감
- 마우스 벗어나면 원위치 복귀
- strength prop으로 강도 조절 가능
- 부드러운 spring 애니메이션
</task>

<task id="4" name="GlowCard 구현">
**What:** 마우스 위치 따라 빛나는 카드 컴포넌트

**How:**
1. `hover/GlowCard.tsx` 파일 생성
2. 마우스 위치 추적
3. radial-gradient로 glow 효과 생성
4. 토큰 primary 색상 사용
5. CSS 변수로 그라데이션 위치 업데이트

**구현 로직:**
```typescript
'use client'

import { useRef } from 'react'
import { motion } from 'motion/react'
import { cn } from '@/lib/utils'

interface GlowCardProps {
  children: React.ReactNode
  className?: string
  glowColor?: string  // default: primary color
}

export function GlowCard({
  children,
  className,
  glowColor = 'var(--color-primary)'
}: GlowCardProps) {
  const ref = useRef<HTMLDivElement>(null)

  const handleMouseMove = (e: React.MouseEvent) => {
    if (!ref.current) return

    const rect = ref.current.getBoundingClientRect()
    const x = e.clientX - rect.left
    const y = e.clientY - rect.top

    ref.current.style.setProperty('--mouse-x', `${x}px`)
    ref.current.style.setProperty('--mouse-y', `${y}px`)
  }

  return (
    <motion.div
      ref={ref}
      onMouseMove={handleMouseMove}
      className={cn(
        'relative overflow-hidden rounded-lg',
        'before:absolute before:inset-0 before:opacity-0',
        'before:transition-opacity before:duration-500',
        'hover:before:opacity-100',
        'before:bg-[radial-gradient(600px_circle_at_var(--mouse-x)_var(--mouse-y),var(--glow-color),transparent_40%)]',
        className
      )}
      style={{ '--glow-color': glowColor } as React.CSSProperties}
    >
      {children}
    </motion.div>
  )
}
```

**Success check:**
- 마우스 이동 시 glow 효과 생김
- 토큰 색상 사용
- 부드러운 전환 애니메이션
- 카드 테두리에서도 작동
</task>

<task id="5" name="ParallaxCard 구현">
**What:** 3D 틸트 효과 카드 컴포넌트

**How:**
1. `hover/ParallaxCard.tsx` 파일 생성
2. 마우스 위치에 따라 rotateX, rotateY 계산
3. perspective 효과 추가
4. 내부 요소 레이어 분리 (transform scale)

**구현 로직:**
```typescript
'use client'

import { useRef, useState } from 'react'
import { motion } from 'motion/react'
import { cn } from '@/lib/utils'

interface ParallaxCardProps {
  children: React.ReactNode
  className?: string
  maxRotation?: number  // default: 15
}

export function ParallaxCard({
  children,
  className,
  maxRotation = 15
}: ParallaxCardProps) {
  const ref = useRef<HTMLDivElement>(null)
  const [rotation, setRotation] = useState({ x: 0, y: 0 })

  const handleMouseMove = (e: React.MouseEvent) => {
    if (!ref.current) return

    const rect = ref.current.getBoundingClientRect()
    const x = (e.clientX - rect.left) / rect.width
    const y = (e.clientY - rect.top) / rect.height

    const rotateX = (y - 0.5) * maxRotation * -1
    const rotateY = (x - 0.5) * maxRotation

    setRotation({ x: rotateX, y: rotateY })
  }

  const handleMouseLeave = () => {
    setRotation({ x: 0, y: 0 })
  }

  return (
    <motion.div
      ref={ref}
      onMouseMove={handleMouseMove}
      onMouseLeave={handleMouseLeave}
      animate={{
        rotateX: rotation.x,
        rotateY: rotation.y,
      }}
      transition={{ type: 'spring', stiffness: 300, damping: 20 }}
      style={{ perspective: 1000 }}
      className={cn('transform-gpu', className)}
    >
      {children}
    </motion.div>
  )
}
```

**Success check:**
- 마우스 이동 시 3D 회전
- 마우스 벗어나면 원위치
- maxRotation prop으로 회전 강도 조절
- 60fps 유지 (transform-gpu)
</task>

<task id="6" name="RippleButton 구현">
**What:** 클릭 시 물결 효과 버튼 컴포넌트

**How:**
1. `hover/RippleButton.tsx` 파일 생성
2. onClick 이벤트에서 ripple 생성
3. AnimatePresence로 ripple 제거
4. 토큰 primary 색상 사용
5. 여러 ripple 동시 지원 (배열)

**구현 로직:**
```typescript
'use client'

import { useState } from 'react'
import { motion, AnimatePresence } from 'motion/react'
import { cn } from '@/lib/utils'

interface Ripple {
  id: number
  x: number
  y: number
}

interface RippleButtonProps {
  children: React.ReactNode
  className?: string
  rippleColor?: string
  onClick?: () => void
}

export function RippleButton({
  children,
  className,
  rippleColor = 'var(--color-primary)',
  onClick
}: RippleButtonProps) {
  const [ripples, setRipples] = useState<Ripple[]>([])

  const handleClick = (e: React.MouseEvent<HTMLButtonElement>) => {
    const button = e.currentTarget
    const rect = button.getBoundingClientRect()
    const x = e.clientX - rect.left
    const y = e.clientY - rect.top

    const newRipple = { id: Date.now(), x, y }
    setRipples(prev => [...prev, newRipple])

    setTimeout(() => {
      setRipples(prev => prev.filter(r => r.id !== newRipple.id))
    }, 600)

    onClick?.()
  }

  return (
    <button
      onClick={handleClick}
      className={cn('relative overflow-hidden', className)}
    >
      {children}
      <AnimatePresence>
        {ripples.map(ripple => (
          <motion.span
            key={ripple.id}
            initial={{ scale: 0, opacity: 0.6 }}
            animate={{ scale: 4, opacity: 0 }}
            exit={{ opacity: 0 }}
            transition={{ duration: 0.6 }}
            style={{
              position: 'absolute',
              left: ripple.x,
              top: ripple.y,
              width: 20,
              height: 20,
              borderRadius: '50%',
              backgroundColor: rippleColor,
              pointerEvents: 'none',
              transform: 'translate(-50%, -50%)',
            }}
          />
        ))}
      </AnimatePresence>
    </button>
  )
}
```

**Success check:**
- 클릭 시 ripple 생성
- 여러 번 클릭 시 중첩 효과
- 토큰 색상 사용
- 600ms 후 자동 제거
</task>

<task id="7" name="Hover 컴포넌트 통합 export">
**What:** 모든 hover 컴포넌트를 한 곳에서 import 가능하도록 설정

**How:**
1. `hover/index.ts` 파일 업데이트
2. 모든 컴포넌트 re-export
3. `animation-v2/index.ts`에서도 export

**Example:**
```typescript
// hover/index.ts
export { MagneticButton } from './MagneticButton'
export { GlowCard } from './GlowCard'
export { ParallaxCard } from './ParallaxCard'
export { RippleButton } from './RippleButton'

// animation-v2/index.ts
export * from './hover'
export * from './utils/motion'
```

**Success check:**
- `import { MagneticButton } from '@/components/animation-v2'` 작동
- `import { GlowCard, ParallaxCard } from '@/components/animation-v2/hover'` 작동
- TypeScript 자동완성 작동
</task>

## Verification

### 수동 테스트:
1. 각 컴포넌트를 페이지에 배치
2. MagneticButton - 마우스 이동 시 버튼 따라옴
3. GlowCard - 마우스 위치에 glow 효과
4. ParallaxCard - 3D 회전 효과
5. RippleButton - 클릭 시 물결 효과

### 성능 테스트:
```bash
# DevTools Performance 탭에서 확인
# 60fps 유지 확인
# CPU 사용률 체크
```

### 접근성 테스트:
```javascript
// prefers-reduced-motion 설정 후 테스트
// 애니메이션이 비활성화되는지 확인
```

## Success Criteria

- [ ] `src/components/animation-v2/` 폴더 구조 생성 완료
- [ ] 공통 유틸리티 함수 구현 (useReducedMotion, spring 등)
- [ ] MagneticButton 구현 및 테스트 완료
- [ ] GlowCard 구현 및 테스트 완료
- [ ] ParallaxCard 구현 및 테스트 완료
- [ ] RippleButton 구현 및 테스트 완료
- [ ] 모든 컴포넌트 통합 export 설정
- [ ] TypeScript 컴파일 에러 없음
- [ ] 60fps 성능 유지
- [ ] prefers-reduced-motion 지원

## Output

**Created files:**
- `src/components/animation-v2/hover/MagneticButton.tsx`
- `src/components/animation-v2/hover/GlowCard.tsx`
- `src/components/animation-v2/hover/ParallaxCard.tsx`
- `src/components/animation-v2/hover/RippleButton.tsx`
- `src/components/animation-v2/hover/index.ts`
- `src/components/animation-v2/utils/motion.ts`
- `src/components/animation-v2/index.ts`

**Ready for Phase 3.2:** Scroll Effects + Transitions

## Notes

- 토큰 시스템의 색상 사용 (Phase 1 성과 활용)
- 기존 animation 폴더는 유지 (하위 호환성)
- animation-v2는 프리미엄 버전
- 모든 애니메이션은 transform-gpu 사용 (성능 최적화)
- 접근성 고려 필수 (prefers-reduced-motion)
