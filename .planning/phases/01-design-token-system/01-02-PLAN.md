# Phase 1.2: Design Token System - Integration & Migration

## Objective

Integrate the token system created in Phase 1.1 into the live application by injecting tokens into Tailwind CSS 4's `@theme` block and migrating existing code to use the token-based system. This completes the design token system implementation.

## Execution Context

**Prerequisites:**
- Phase 1.1 completed: `/tokens` folder with all 6 color packages
- Utility functions available: `getCSSVariables()`, `getTailwindConfig()`

**Current State:**
- `src/app/globals.css` has inline `@theme` with hardcoded oklch values
- `src/styles/color-schemes.ts` still used by components
- Components reference hardcoded color values

**Target State:**
- `globals.css` @theme block populated with token values
- Default color package (warmElegance) active
- `src/styles/color-schemes.ts` refactored to export tokens
- All components use token-based colors
- Ready for Phase 4 (Dynamic Theme Switcher)

**Files to Modify:**
- `src/app/globals.css` - Inject token CSS variables
- `src/styles/color-schemes.ts` - Refactor to use tokens
- Components using hardcoded colors - Migrate to tokens

## Context

### Tailwind CSS 4 Integration Pattern:
The new Tailwind CSS 4 uses `@theme inline` in globals.css. We need to:
1. Replace hardcoded oklch values with token-based CSS variables
2. Map token scales to Tailwind semantic names (primary, secondary, accent, etc.)
3. Maintain dark mode support
4. Keep existing border, ring, and other design tokens

### Migration Strategy:
1. Inject warmElegance as default color package
2. Update @theme block with token CSS variables
3. Refactor color-schemes.ts to re-export from tokens
4. Update any components with hardcoded values
5. Verify all existing components still work

## Tasks

<task id="1" name="Create CSS variable injection helper">
**What:** Build a script/function to convert tokens to CSS variables for globals.css.

**How:**
1. Create `scripts/generate-css-vars.ts`
2. Import `getCSSVariables` from tokens/utils
3. Generate CSS variable declarations for warmElegance (default)
4. Map to Tailwind semantic names:
   - `primary` → `--color-primary` (from tokens primary-500)
   - `primary-foreground` → `--color-primary-foreground` (from tokens primary-50)
   - `accent` → `--color-accent` (from tokens accent-500)
   - etc.

**Example output:**
```css
:root {
  /* Brand colors from warmElegance tokens */
  --color-primary: #C4A77D;
  --color-primary-foreground: #FAF8F5;
  --color-accent: #D4A373;
  --color-accent-foreground: #2C1810;

  /* Existing design tokens */
  --radius: 0.625rem;
  --background: oklch(1 0 0);
  --foreground: oklch(0.145 0 0);
  /* ... keep existing */
}
```

**Success check:**
- Script generates valid CSS variables
- All token scales mapped to Tailwind semantics
- Dark mode variants generated
- Can be run with `tsx scripts/generate-css-vars.ts`
</task>

<task id="2" name="Update globals.css with token CSS variables">
**What:** Inject token-based CSS variables into the @theme block in globals.css.

**How:**
1. Run the CSS variable generator from Task 1
2. Update `src/app/globals.css` @theme inline block:
   - Keep existing `--radius`, `--font-*` tokens
   - Replace color tokens with warmElegance values
   - Maintain oklch format for compatibility
   - Add dark mode variants in `.dark` block
3. Add comment indicating tokens are from design system

**Before:**
```css
@theme inline {
  --color-primary: oklch(0.205 0 0);  /* Generic gray */
  --color-primary-foreground: oklch(0.985 0 0);
}
```

**After:**
```css
@theme inline {
  /* Design tokens from /tokens (warmElegance package) */
  --color-primary: oklch(0.72 0.08 75);  /* Warm Elegance primary-500 */
  --color-primary-foreground: oklch(0.98 0.01 80);  /* primary-50 */
  --color-accent: oklch(0.70 0.09 65);   /* Warm Elegance accent-500 */
  /* ... */
}
```

**Success check:**
- All Tailwind semantic colors updated
- Dark mode variants updated in `.dark` block
- No hardcoded grays - all from token system
- Page renders correctly with new colors
- `npm run dev` works without errors
</task>

<task id="3" name="Refactor color-schemes.ts to use tokens">
**What:** Replace hardcoded color objects in color-schemes.ts with token re-exports.

**How:**
1. Open `src/styles/color-schemes.ts`
2. Import all packages from `/tokens`
3. Create adapter to match old ColorScheme interface
4. Re-export with backwards compatibility

**Before:**
```typescript
export const warmElegance: ColorScheme = {
  colors: {
    primary: "#C4A77D",
    primaryLight: "#D9C5A7",
    // ... hardcoded
  }
}
```

**After:**
```typescript
import { warmElegance as warmEleganceToken, type ColorPackage } from '@/tokens'

// Adapter: Token format → Legacy ColorScheme format
function tokenToLegacy(pkg: ColorPackage): ColorScheme {
  return {
    colors: {
      primary: pkg.colors.primary[500],
      primaryLight: pkg.colors.primary[400],
      primaryDark: pkg.colors.primary[600],
      // ... map all fields
    }
  }
}

export const warmElegance = tokenToLegacy(warmEleganceToken)
// Export all 6 packages
```

**Success check:**
- All 6 packages re-exported from tokens
- Legacy interface maintained for backwards compatibility
- No compilation errors
- Existing components using ColorScheme still work
</task>

<task id="4" name="Create theme switcher utility (preparation for Phase 4)">
**What:** Add a utility function to dynamically switch color packages at runtime.

**How:**
1. Create `src/lib/theme-utils.ts`
2. Add `setColorPackage(packageName)` function
3. Function should:
   - Load the specified package from tokens
   - Generate CSS variables
   - Update :root CSS variables dynamically
   - Save preference to localStorage

**Example:**
```typescript
// src/lib/theme-utils.ts
import { getAllPackages, getCSSVariables } from '@/tokens'

export function setColorPackage(packageName: string) {
  const packages = getAllPackages()
  const pkg = packages.find(p => p.name === packageName)

  if (!pkg) throw new Error(`Package ${packageName} not found`)

  const cssVars = getCSSVariables(pkg)
  Object.entries(cssVars).forEach(([key, value]) => {
    document.documentElement.style.setProperty(key, value)
  })

  localStorage.setItem('color-package', packageName)
}

export function getActivePackage(): string {
  return localStorage.getItem('color-package') || 'Warm Elegance'
}
```

**Success check:**
- Utility functions created
- Can switch packages programmatically
- LocalStorage saves preference
- Changes apply immediately to :root
- Ready for Phase 4 UI integration
</task>

<task id="5" name="Audit and migrate hardcoded color values">
**What:** Find and replace any remaining hardcoded color values in components.

**How:**
1. Search codebase for hex colors: `grep -r "#[0-9A-F]{6}" src/`
2. Search for rgb/rgba: `grep -r "rgb\(" src/`
3. For each hardcoded value:
   - Identify the intent (primary, accent, background, etc.)
   - Replace with Tailwind class: `bg-primary`, `text-accent`, etc.
   - Or use CSS variable: `var(--color-primary)`
4. Update any inline styles or style objects

**Common replacements:**
- `#C4A77D` → `bg-primary` or `var(--color-primary)`
- `#F5F0E8` → `bg-primary-foreground`
- Hardcoded grays → `bg-muted`, `text-muted-foreground`

**Success check:**
- No hardcoded hex colors in components (except maybe brand logos)
- All UI elements use Tailwind classes or CSS variables
- Visual appearance unchanged after migration
- All pages render correctly
</task>

<task id="6" name="Add TypeScript path alias for tokens">
**What:** Ensure tokens can be imported with `@/tokens` alias.

**How:**
1. Check `tsconfig.json` has path alias for `/tokens`
2. If not, add:
   ```json
   {
     "compilerOptions": {
       "paths": {
         "@/*": ["./src/*"],
         "@/tokens": ["./tokens"]
       }
     }
   }
   ```
3. Verify imports work: `import { warmElegance } from '@/tokens'`

**Success check:**
- `@/tokens` import alias works
- TypeScript autocomplete functional
- No import errors
</task>

## Verification

### Visual Tests:
1. Run `npm run dev`
2. Visit homepage - should look identical to before (warmElegance colors)
3. Check all pages:
   - Buttons should have warmElegance primary color
   - Cards should have warmElegance accent colors
   - Text should maintain readability
4. Toggle dark mode - should still work

### Code Tests:
```bash
# Check for remaining hardcoded colors (should be minimal)
grep -r "#[0-9A-F]\{6\}" src/components src/app | grep -v ".css" | wc -l

# Verify token imports work
tsx -e "import { warmElegance } from './tokens'; console.log(warmElegance.colors.primary[500])"

# Build check
npm run build
```

### Manual Verification:
1. Open browser DevTools
2. Inspect `:root` CSS variables - should see warmElegance values
3. Try `setColorPackage('Royal Mauve')` in console
4. Page should instantly change colors
5. Refresh - should persist (localStorage)

## Success Criteria

- [ ] `globals.css` @theme block updated with warmElegance token values
- [ ] All 6 color packages accessible via tokens
- [ ] `color-schemes.ts` refactored to re-export from tokens (backwards compatible)
- [ ] Theme switcher utility created (`setColorPackage`, `getActivePackage`)
- [ ] No hardcoded color values in components (except logos/assets)
- [ ] TypeScript path alias `@/tokens` configured
- [ ] All pages render correctly with new token system
- [ ] Dark mode still functional
- [ ] `npm run build` succeeds
- [ ] Visual appearance unchanged (warmElegance as default)

## Output

**Modified files:**
- `src/app/globals.css` - Token-based @theme block
- `src/styles/color-schemes.ts` - Token re-exports
- `tsconfig.json` - @/tokens path alias
- Components with hardcoded colors - Migrated to tokens

**Created files:**
- `scripts/generate-css-vars.ts` - CSS variable generator
- `src/lib/theme-utils.ts` - Theme switching utilities

**Ready for:**
- Phase 2: Mystical Wave Interactive System (uses token colors)
- Phase 3: Premium Micro-Interaction Library (uses token colors)
- Phase 4: Dynamic Theme Switcher (uses theme-utils.ts)

## Notes

- Keep warmElegance as default for consistency
- Don't delete original color-schemes.ts structure (backwards compatibility)
- Theme switcher UI will be built in Phase 4
- This phase focuses on infrastructure, not user-facing features
- All existing components should work unchanged after migration
